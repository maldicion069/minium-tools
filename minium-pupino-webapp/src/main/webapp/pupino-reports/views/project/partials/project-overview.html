<div class="content">
    <!-- Main row -->
    <section class="col-md-7">
        <div class="row">
            <div class="box box-danger box-mt">
                <div class="box-header">
                    <i class="fa fa-rocket"></i>
                    <h3 class="box-title">Last test executions
                    </h3>

                    <div class="box-tools btn-group pull-right" data-toggle="buttons">
                        <label class="btn btn-default btn-sm" ng-click="status = 'SUCCESS'" title="Succeeded">
                            <input type="radio"></input>
                            <i class="fa fa-square text-green"></i>
                        </label>
                        <label class="btn btn-default btn-sm" ng-click="status = 'UNSTABLE'" title="Failed">
                            <input type="radio"></input>
                            <i class="fa fa-square text-red"></i>
                        </label>
                        <label class="btn btn-default btn-sm" ng-click="status = ''" title="All">
                            <input type="radio"></input>
                            <i class="fa fa-square"></i>
                        </label>
                    </div>
                </div>

                &nbsp;
                <a id="launchBtn" class="btn btn-primary btn-xs" ui-sref="global.project-detail.overview.launch" title="Launch an execution to run the tests">
                    <i class="fa fa-play"></i> Launch Test execution
                </a>

                <div class="box-body ">

                    <!-- Alert No data -->
                    <div class="alert alert-info" ng-show="!buildsFacade.lastFinishedBuild && !buildingBuilds && !buildsFacade.buildingBuilds">
                        <a class="btn btn-xs btn-primary pull-right" ng-click="createBuild()">
                            <i class="fa fa-play"></i> Launch Test execution
                        </a>
                        <strong>Info:</strong> Theres no data
                    </div>

                    <table class="table table-primary table-list" ng-show="buildsFacade.lastFinishedBuild || buildsFacade.buildingBuilds">
                        <thead>
                            <tr>
                                <th>Status</th>
                                <th>Name</th>
                                <th>Time</th>
                                <th>Duration</th>
                                <th>%</th>
                                <th></th>
                            </tr>
                        </thead>
                        <!-- BUILDING BUILDS -->
                        <tbody>

                            <tr ng-show="buildsFacade.buildingBuilds.length > 0">
                                <td ng-hide="estimatedTime == 0">
                                    <i class="fa fa-2x fa-gear fa-spin"></i>
                                    <!-- <span ng-repeat="b in buildsFacade.buildingBuilds">
                                        {{b.id}} 
                                    </span> -->
                                </td>

                                <td></td>

                                <td ng-hide="estimatedTime != 0"> <i class="fa fa-spinner fa-spin"></i> Fetching data </td>
                                <td ng-hide="estimatedTime == 0">
                                    Launched at {{time}}
                                    <!-- <br> Estimated Time {{duration | durationInMinutes}} seconds -->
                                    <!-- <br> {{estimatedRemainning}} -->
                                    <!-- Remainning {{estimatedRemainning | humanize}} -->
                                    <br>

                                </td>
                                <td ng-hide="estimatedTime == 0">
                                    {{buildingBuilds[0].state}} Executing
                                </td>

                                <td ng-hide="estimatedTime == 0">
                                    <div class="progress progress-striped active sm">
                                        <div class="progress-bar bar" style="width: {{estimatedTime}}%;">

                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                        

                        <!-- LAST BUILD -->
                        <tbody ng-show="buildsFacade.lastFinishedBuild">
                            <tr ng-class="{'danger' : (buildsFacade.lastFinishedBuild.result != 'SUCCESS') }">
                                <td>
                                    <icon-item content="buildsFacade.lastFinishedBuild.result" type="build">
                                    </icon-item>
                                    <br>
                                    <span ng-if="$index == 0" class="label label-primary">
                                        Last Stable buildsFacade.lastFinishedBuild
                                    </span>
                                </td>
                                <td>
                                    <a ui-sref="global.build({ id: project.id, buildId: buildsFacade.lastFinishedBuild.id })">
                                        {{buildsFacade.lastFinishedBuild.fullDisplayName}}
                                    </a>

                                </td>
                                <td>
                                    <i class="fa fa-clock-o"></i> {{buildsFacade.lastFinishedBuild.key | humanizeDate}}
                                </td>
                                <td>
                                    {{buildsFacade.lastFinishedBuild.duration | durationMilliseconds}}
                                </td>

                                <td>

                                    <progress>
                                        <bar value="calcPerCent(summary.passed,summary.totalScenarios)" type="success">
                                            <span>{{calcPerCent(summary.passed,summary.totalScenarios)}}%</span>
                                        </bar>
                                        <bar value="calcPerCent(summary.failed,summary.totalScenarios)" type="danger">
                                            <span>{{calcPerCent(summary.failed,summary.totalScenarios)}}%</span>
                                        </bar>
                                        <bar value="calcPerCent(summary.skipped,summary.totalScenarios)" type="warning">
                                            <span>{{calcPerCent(summary.skipped,summary.totalScenarios)}}%</span>
                                        </bar>
                                        <bar value="calcPerCent(summary.undefined,summary.totalScenarios)" type="info">
                                            <span>{{calcPerCent(summary.undefined,summary.totalScenarios)}}%</span>
                                        </bar>
                                    </progress>
                                </td>


                                <td>
                                    <a class='btn btn-primary btn-xs' ui-sref="global.build({ id: project.id, buildId: buildsFacade.lastFinishedBuild.id })">
                                       Show
                                    </a>
                                </td>
                            </tr>
                        </tbody>

                        <!-- other builds -->
                        <thead>
                            <tr>
                                <th colspan="7">Other Executions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="build in buildsFacade.builds | filter:{result :status}" ng-class="{'danger' : (build.result != 'SUCCESS') }">
                                <td>
                                    <icon-item content="build.result" type="build"></icon-item>
                                    <br>
                                </td>
                                <td>
                                    <a ui-sref="global.build({ id: project.id, buildId: build.id })">{{build.fullDisplayName}}</a>
                                </td>
                                <td>
                                    <i class="fa fa-clock-o"></i> {{build.key | humanizeDate}}
                                </td>
                                <td>
                                    {{build.duration | durationMilliseconds}}
                                </td>
                                <td></td>
                                <td>
                                    <a class='btn btn-primary btn-xs' ui-sref="global.build({ id: project.id, buildId: build.number })">
                                       Show
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- /.box-->
            </div>
        </div>
        <div class="row">
            <div class="box box-success box-mt">
                <div class="box-header">
                    <i class="fa fa-warning"></i>
                    <span class="circle circle-danger circle-lg text-left"></span>
                    <h3 class="box-title">Identified problems
                    <span class="label label-danger">{{faillingFeatures.length}}</span>
                     </h3>
                </div>
                <div class="box-body ">

                    <!-- Alert No data -->
                    <div class="alert alert-info" ng-show="faillingFeatures.length == 0">
                        <strong>Info:</strong> Theres no data
                    </div>

                    <table class="table table-primary table-list" ng-show="faillingFeatures.length > 0">
                        <thead>
                            <tr>
                                <th>Result</th>
                                <th>Feature</th>
                                <th>Total</th>
                                <th>Passed</th>
                                <th>Failed</th>
                                <th>Duration</th>
                                <th>File</th>
                                <th class="text-center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="feature in faillingFeatures" ng-class="{'danger' : !isPassed(feature.status),'success' : isPassed(feature.status)}">
                                <td>
                                    <span class="hide">{{feature.status}}</span>
                                    <icon-item content="feature.status" type="feature"></icon-item>
                                </td>
                                <td>
                                    <a ui-sref="global.feature({ id: project.id, buildId: buildsFacade.lastFinishedBuild.id, featureURI: (feature.uri | escape) })">
                                    {{feature.rawName}}
                                    </a>
                                </td>
                                <td>
                                    {{summary.totalScenarios}}
                                </td>
                                <td style="background-color:grenn;">
                                    {{summary.passed}}
                                </td>
                                <td>
                                    {{feature.numberOfFailures}}
                                </td>
                                <td>
                                    {{feature.durationOfSteps}}
                                </td>
                                <td>
                                    <a class='btn btn-primary btn-xs' ng-href="{{location}}/editor/{{feature.uri}}?line=1" target="_blank">
                                       Go to File
                                    </a>
                                </td>
                                <td>
                                    <div class="btn-group">
                                        <a data-toggle="dropdown" class="dropdown-toggle">
                                            <i class="fa fa-cog"></i>
                                        </a>
                                        <ul role="menu" class="dropdown-menu pull-right">
                                            <li><a href="#">View</a>
                                            </li>
                                            <li><a href="#">Close</a>
                                            </li>
                                            <li><a href="#">Resolve</a>
                                            </li>
                                            <li class="divider"></li>
                                            <li><a href="#">Assign</a>
                                            </li>
                                            <li><a href="#">Comment</a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <!-- /.box-->
            </div>
        </div>
    </section>
    <!-- end of section col-md-7 -->
    <section class="col-md-5 connectedSortable ui-sortable">
        <div class="nav-tabs-custom" style="cursor: move;">
            <!-- Tabs within a box -->
            <ul class="nav nav-tabs pull-right">
                <li class="active"><a show-tab href="#pie-chart" data-toggle="tab">Donut</a>
                </li>
                <li><a show-tab href="#line-chart" data-toggle="tab">Evolution</a>
                </li>

                <li class="pull-left header"><i class="fa fa-inbox"></i> Stats for scenarios of last executions
                </li>
            </ul>
            <div class="tab-content no-padding">
                <div class="chart tab-pane active" id="pie-chart">
                    <nvd3-pie-chart data="exampleData1" id="exampleId1" width="500" height="300" x="xFunction()" y="yFunction()" showLabels="true" showLegend="true" color="colorFunction()" legendColor="colorFunction()" labelType="percent" donut="true" donutRatio=".50" noData="No Data For You!" showYAxis="true">
                        <svg></svg>
                    </nvd3-pie-chart>
                </div>

                <div class="chart tab-pane " id="line-chart">
                    <!-- <nvd3-line-chart data="exampleData" id="exampleId" width="550" height="350" showXAxis="true" showYAxis="true" showLegend="true" legendColor="colorFunction()" color="colorFunction()" isArea="true" tooltips="true" interactive="true" noData="No Data For You!">
                        <svg></svg>
                    </nvd3-line-chart> -->
                </div>

            </div>
            <div class="panel-footer hidden-xs">
                <div class="row">
                    <div class="col-sm-6">
                        <!-- Progress bars -->
                        <div class="clearfix">
                            <span class="pull-left">Success</span>
                            <small class="pull-right">{{(100*summary.passed/summary.totalScenarios)| number:2}}%</small>
                        </div>



                        <div class="progress xs">
                            <div style="width: {{(100*summary.passed/summary.totalScenarios)| number:2}}%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="2" role="progressbar" class="progress-bar progress-bar-success">
                                <span class="sr-only">{{(100*summary.passed/summary.totalScenarios)| number:2}}% Complete (success)</span>
                            </div>
                        </div>
                    </div>
                    <!-- /.col -->
                    <div class="col-sm-6">
                        <div class="clearfix">
                            <span class="pull-left">Failures</span>
                            <small class="pull-right">{{(100*summary.failed/summary.totalScenarios)| number:2}}% </small>
                        </div>
                        <div class="progress xs">
                            <div style="width: {{(100*summary.failed/summary.totalScenarios)| number:2}}%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="15" role="progressbar" class="progress-bar progress-bar-danger">
                                <span class="sr-only">{{(100*summary.failed/summary.totalScenarios)| number:2}}% Complete (success)</span>
                            </div>
                        </div>
                    </div>
                    <!-- /.col -->
                </div>
                <!-- /.row -->
            </div>
        </div>
        <div class="box box-mt">
            <div class="box-header">
                <h3 class="box-title">Shortcuts</h3>
            </div>
            <div class="box-body">
                <a class="btn btn-app" ng-click="createBuild()">
                    <i class="fa fa-play"></i> Launch Build
                </a>
                <a class="btn btn-app">
                    <i class="fa fa-list"></i> Feature List
                </a>
                <a class="btn btn-app">
                    <i class="fa fa-edit"></i> Edit Files
                </a>
            </div>

            <!-- /.box-body -->
        </div>
        <div class="box box-mt">
            <div class="box-header">
                <h3 class="box-title">
               <i class="fa fa-star"></i> Summary Last Build 
               <strong>Total Scenarios</strong> 
               <span class="label label-primary">{{summary.totalScenarios}}</span>
            </h3>
            </div>
            <!-- /.box-header -->
            <div class="box-body no-padding">
                <div class="tab-pane fade active in" id="summary">
                    <table class="table">
                        <thead>
                            <tr class="table-head-alt">
                                <th>Status</th>
                                <th>Issues</th>
                                <th>Percentage</th>
                                <th>&nbsp;</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><a href="">Passed</a>
                                </td>
                                <td>{{summary.passed}}
                                </td>
                                <td>
                                    <div class="progress">
                                        <div style="width: {{(100*summary.passed/summary.totalScenarios)| number:2}}%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="2" role="progressbar" class="progress-bar progress-bar-success">
                                            <span class="sr-only">{{(100*summary.passed/summary.totalScenarios)| number:2}}% Complete (success)</span>
                                        </div>
                                    </div>
                                </td>
                                <td>{{(100*summary.passed/summary.totalScenarios)| number:2}}%</td>
                            </tr>
                            <tr>
                                <td><a href="">Failures</a>
                                </td>
                                <td>{{summary.failed}}</td>
                                <td>
                                    <div class="progress">
                                        <div style="width: {{(100*summary.failed/summary.totalScenarios)| number:2}}%" aria-valuemax="100" aria-valuemin="0" aria-valuenow="15" role="progressbar" class="progress-bar progress-bar-danger">
                                            <span class="sr-only">{{(100*summary.failed/summary.totalScenarios)| number:2}}% Complete (success)</span>
                                        </div>
                                    </div>
                                </td>
                                <td>{{(100*summary.failed/summary.totalScenarios)| number:2}}%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- /.box-body -->
        </div>
    </section>
</div>
</section>
